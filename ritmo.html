<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RITMO</title>

<style>
:root{
 --bg:#072146;
 --card:#ffffff;
 --accent:#e6eefc;
 --ok:#16a34a;
 --err:#ef4444;
 --primary:#2563eb;
}
*{box-sizing:border-box}
body{
 margin:0;
 padding:18px;
 font-family:Inter, Poppins, Arial, sans-serif;
 background: var(--bg);
 min-height:100vh;
 display:flex;
 align-items:center;
 justify-content:center;
 color:var(--accent);
}
.quiz-container{
 width:100%;
 max-width:1200px;
 background:var(--card);
 border-radius:14px;
 padding:22px;
 box-shadow:0 12px 40px rgba(0,0,0,0.35);
 color:#03133d;
}
h1{
 margin:0 0 22px;
 text-align:center;
 color:#0f172a;
 font-size:2.4rem;
}
.intro {text-align:center; margin:18px 0}
.question {font-size:1.05rem; margin:10px 0 14px; color:#0f172a}
.pretext {font-size:1rem; color:#374151; margin-bottom:8px;}
.progress {
  text-align: center;
  font-size: 1.1rem;
  font-weight: 710;
  color: #191070;          /* azul principal */
  margin-bottom: 10px;
}
@keyframes popProgress {
  0%   { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

.progress {
  animation: popProgress 2.20s ease-out;
}

/* Oculto reproductor viejo */
.main-audio { display:none !important; }

/* Reproductor grande */
.secondary-audio {
  margin: 8px 0 16px;
  text-align: left;
}
.secondary-audio audio {
  width: 380px;
  height: 40px;
}

.answers {display:flex; flex-direction:column; gap:10px;}
.option-row { display:flex; gap:10px; align-items:center; margin-bottom:8px; position:relative; }
.option-number { width:100px; text-align:right; font-weight:600; font-size:1rem; color:#0f172a; }

@media(max-width:720px){
 .option-number{width:80px;font-size:0.9rem;}
}

.play-wrap {
 width:65px;
 display:flex; 
 background:#c7e9ff;
 border-radius:10px;
 padding:6px;
}
.audio-btn{
 width:46px;
 height:46px;
 border-radius:50%;
 border:0;
 background:linear-gradient(135deg,#3b82f6,#60a5fa);
 color:white;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:18px;
 cursor:pointer;
 box-shadow:0 8px 20px rgba(37,99,235,0.26);
 transition: transform .14s, box-shadow .14s, opacity .14s;
}
.audio-btn:hover{transform:scale(1.06)}
.audio-btn.playing{
 background:linear-gradient(135deg,#10b981,#34d399);
 box-shadow:0 10px 26px rgba(16,185,129,0.22)
}
.answer-btn {
 flex:1;
 max-width:180px;
 text-align:center;
 padding:10px 12px;
 font-size:1.2rem;
 border-radius:8px;
 border:1px solid #fcd34d;
 background:#ffe9cc;
 cursor:pointer;
 transition: background 0.12s, transform 0.12s;
 position:relative;
}
.answer-btn:hover{background:#ffd8a8; transform:scale(1.03)}
.answer-btn:disabled{opacity:.6; cursor:not-allowed}
.answer-btn.correct{background:var(--ok); color:white}
.answer-btn.wrong{background:var(--err); color:white}
.icon {
 position: absolute;
 right: -45px;
 top: 50%;
 transform: translateY(-50%) scale(0);
 font-size: 1.6rem;
 opacity: 0;
 transition: all 0.3s ease;
}
.answer-btn.correct .icon {
 color: var(--ok);
 transform: translateY(-50%) scale(1.1);
 opacity: 1;
}
.answer-btn.wrong .icon {
 color: var(--err);
 transform: translateY(-50%) scale(1.1);
 opacity: 1;
}
.controls {display:flex; justify-content:center; margin-top:16px; gap:12px;}
.btn {
 padding:10px 16px;
 border-radius:10px;
 border:0;
 background:var(--primary);
 color:white;
 font-weight:600;
 cursor:pointer
}
.btn.ghost { background:white; color:#0f172a; border:1px solid #e6eefc }
.summary {text-align:center}

.model-audio{
  display: flex;
  align-items: center;
  gap: 12px;
}

.model-label{
  font-weight: 700;
  color: #1843a1;
  font-size: 1rem;
}
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding-top: 8px;   /* qu√© tan arriba aparece */
  z-index: 9999;
}

.modal.hidden {
  display: none;
}

.modal-box {
  background: white;
  padding: 28px 34px;
  border-radius: 16px;
  max-width: 520px;
  text-align: center;
  box-shadow: 0 20px 50px rgba(0,0,0,0.35);
  animation: modalPop 0.35s ease-out;
}

@keyframes modalPop {
  from { transform: scale(0.85); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

.modal-box p {
  font-size: 1.4rem;
  font-weight: 600;
  margin-bottom: 22px;
}

.modal-box.success p {
  color: #16a34a;
}

.modal-box.fail p {
  color: #dc2626;
}
.page-wrapper{
  display:flex;
  flex-direction:column;
  align-items:center;
}

.credits{
  margin-top:12px;
  width:100%;
  max-width:1200px;
  padding-left:22px;
  padding-right:22px;
  text-align:left;
  font-size:0.65rem;
  line-height:1.6;      /* üëà clave */
  color:#cbd5e1;
  opacity:0.85;
  letter-spacing:0.4px;
}
</style>
</head>

<body>

<div class="page-wrapper">

  <div class="quiz-container" role="main">
    <div id="app"></div>
  </div>

  <div class="credits">
  ¬© <span id="year"></span> DTI. Arturo Hern√°ndez Maldonado. Material did√°ctico elaborado como investigaci√≥n educativa. Instituto de Educaci√≥n Media Superior de la Ciudad de M√©xico (IEMS)
</div>

</div>
<script>

/* ======== CONTROL DE L√çMITE DE REPRODUCCIONES ======== */
const playCounts = {};
const MAX_PLAYS = 3;

function canPlayAudio(file) {
  if (!playCounts[file]) playCounts[file] = 0;

  if (playCounts[file] >= MAX_PLAYS) {
    alert("Ya escuchaste 3 veces este audio");
    return false;
  }
  playCounts[file]++;
  return true;
}

/* ============================= CONFIG ============================= */
const baseQuestions = [
 {
   pretext: "Escucha el modelo y elige la opci√≥n que sea id√©ntica al modelo. <br>Para contestar da clic en el recuadro que tiene signo de interrogaci√≥n. <br> <span style='color:red; font-weight:600;'>Para repetir el ejercicio recarga la p√°gina</span>, cambiar√°n de orden la opciones de respuesta.",
   audio: "p1.mp3",
   question: "",
   answers: [
     { text: "?", correct: true, audio: "op1a.mp3" },
     { text: "?", correct: false, audio: "op1b.mp3" },
	 { text: "?", correct: false, audio: "op1c.mp3" },
     { text: "?", correct: false, audio: "op1d.mp3" }
   ]
  
 },
 {
   pretext: "Elige la opci√≥n en la que el pulso percutido sea id√©ntico al pulso de la m√∫sica",
   question: "",
   answers: [
     { text: "?", correct: true, audio: "S2op3.mp3" },
     { text: "?", correct: false, audio: "S2op2.mp3" },
	 { text: "?", correct: false, audio: "S2op4.mp3" },
     { text: "?", correct: false, audio: "S2op1.mp3" }
   ]
    
 }
 
];

/* ============================= VARIABLES ============================= */
let questions = [];
let currentIndex = 0;
let correctAnswers = 0;
let userAnswers = [];
let shuffledAnswers = [];
let userName = "";

/* ============================= INTRO ============================= */
function showIntro() {
 document.getElementById("app").innerHTML = `
   <div class="intro">
     <h1 id="title">RITMO</h1>
     <h2></h2>
     <p style="font-size:1.75rem; color:#03133d;">Retenci√≥n e Identificaci√≥n del Pulso<br> <span style="font-size:1rem; color:#3d0303;">2 preguntas</span>
</p>
     <button class="btn" onclick="startQuiz()">Iniciar</button>
   </div>
 `;
}

function startQuiz() {
  // Clonamos las preguntas
  const cloned = baseQuestions.map(q => ({ ...q, answers: [...q.answers] }));

  // Primera pregunta fija
  const firstQuestion = cloned[0];

  // Resto de preguntas barajadas
  const rest = cloned.slice(1).sort(() => Math.random() - 0.5);

  // Unimos todo
  questions = [firstQuestion, ...rest];

  currentIndex = 0;
  correctAnswers = 0;
  userAnswers = [];
  shuffledAnswers = [];
  showQuestion();
}

/* ============================= PREGUNTA ============================= */

let currentAudio = null;
let currentBtn = null;

function showQuestion() {

 if (currentAudio) {
   try { currentAudio.pause(); } catch(e) {}
   if (currentBtn) {
     currentBtn.textContent = "‚ñ∂";
     currentBtn.classList.remove("playing");
   }
   currentAudio = null;
   currentBtn = null;
 }

 const q = questions[currentIndex];

 let shuffled = shuffledAnswers[currentIndex];
 if (!shuffled) {
   shuffled = [...q.answers].sort(() => Math.random() - 0.5);
   shuffledAnswers[currentIndex] = shuffled;
 }

 const saved = userAnswers[currentIndex] ?? null;

 document.getElementById("app").innerHTML = `
   <div class="progress">Pregunta ${currentIndex + 1} de ${questions.length}</div>
   <div class="pretext">${q.pretext}</div>

   ${q.audio ? `
  <div class="secondary-audio model-audio">
    <span class="model-label">Modelo</span>
    <audio controls src="${q.audio}"></audio>
  </div>
` : ""}

   <div class="question">${q.question}</div>

   <div class="answers">
  ${shuffled.map((ans, i) => {
    let state = "";
    let icon = ans.correct ? "‚úî" : "‚úñ";

    if (saved !== null) {
      if (saved.index === i) state = saved.correct ? "correct" : "wrong";
      if (!saved.correct && ans.correct) state = "correct";
    }

    return `
      <div class="option-row">
        <div class="option-number">Opci√≥n ${i + 1}</div>

        <div class="play-wrap">
          <button class="audio-btn" onclick="playAudio('${ans.audio}', this)">‚ñ∂</button>
        </div>

        <button class="answer-btn ${state}"
          ${saved !== null ? "disabled" : ""}
          onclick='selectAnswer(${ans.correct}, this, ${i})'>
          ${ans.text}
          <span class="icon">${icon}</span>
        </button>
      </div>
    `;
  }).join("")}
</div>

<div class="controls">
 
</div>
`;

 /* ===== L√≠mite del AUDIO GRANDE ===== */
 const bigAudio = document.querySelector(".secondary-audio audio");
if (bigAudio) {
  bigAudio.onplay = () => {
    if (!canPlayAudio(q.audio)) {
      bigAudio.pause();
    }
  };
}

}

/* ============================= AUDIO ============================= */

function playAudio(file, btn) {

 if (!canPlayAudio(file)) return;

 if (currentAudio && currentBtn === btn) {
   currentAudio.pause();
   btn.textContent = "‚ñ∂";
   btn.classList.remove("playing");
   currentAudio = null;
   currentBtn = null;
   return;
 }

 if (currentAudio) {
   try { currentAudio.pause(); } catch(e){}
   if (currentBtn) {
     currentBtn.textContent = "‚ñ∂";
     currentBtn.classList.remove("playing");
   }
 }

 currentAudio = new Audio(file);
 currentBtn = btn;

 btn.textContent = "‚ùö‚ùö";
 btn.classList.add("playing");

 currentAudio.onended = () => {
   if (currentBtn) {
     currentBtn.textContent = "‚ñ∂";
     currentBtn.classList.remove("playing");
   }
   currentAudio = null;
   currentBtn = null;
 };

 currentAudio.play().catch(()=>{});
}

/* ============================= RESPUESTAS ============================= */

function selectAnswer(correct, btn, indexSelected) {

 if (currentAudio) {
   try { currentAudio.pause(); } catch(e){}
   if (currentBtn) currentBtn.textContent = "‚ñ∂";
 }

 document.querySelectorAll(".answer-btn").forEach(b => (b.disabled = true));

 const sound = new Audio(correct ? "correct.mp3" : "wrong.mp3");
 sound.volume = 0.9;
 sound.play();

 userAnswers[currentIndex] = { index: indexSelected, correct: correct };

 if (correct) {
   btn.classList.add("correct");
   correctAnswers++;
 } else {
   btn.classList.add("wrong");
   const correctIndex = shuffledAnswers[currentIndex].findIndex(a => a.correct);
   const allAnswerBtns = document.querySelectorAll(".answer-btn");
   if (allAnswerBtns[correctIndex]) allAnswerBtns[correctIndex].classList.add("correct");
 }

 setTimeout(() => {
   currentIndex++;
   if (currentIndex >= questions.length) { showSummary(); return; }
   showQuestion();
 }, 3300);
}

/* ============================= RESUMEN ============================= */

function showSummary() {
 const percent = Math.round((correctAnswers / questions.length) * 100);

 let frase = "";
 if (percent === 100) frase = "¬°Excelente! Para una simulaci√≥n completa escribe a rdidacticosmusica@gmail.com";
 else if (percent >= 75) frase = "¬°Muy bien hecho! Est√°s muy cerca de la perfecci√≥n. Para una simulaci√≥n completa escribe a rdidacticosmusica@gmail.com";
 else if (percent >= 50) frase = "Sigue practicando y mejorar√°s. Para una simulaci√≥n completa escribe a rdidacticosmusica@gmail.com";
 else frase = "Cada intento te hace m√°s fuerte. Para una simulaci√≥n completa escribe a rdidacticosmusica@gmail.com";

 document.getElementById("app").innerHTML = `
  <div class="summary">
    <h2>¬°Has terminado!</h2>

    <p>Respuestas correctas:
      <strong>${correctAnswers}</strong> /
      <strong>${questions.length}</strong>
    </p>

    <p style="font-size:1.4rem; color:#2563eb; font-weight:700;">
      Calificaci√≥n: ${percent}%
    </p>

    <p style="margin-top:14px; font-size:1.1rem; color:#0f172a;">
      <em>${frase}</em>
    </p>

    <div class="controls">
      
      </div>
  </div>
 `;
/* ================== POPUP Y REDIRECCI√ìN ================== */
 // Cambia esta URL por la del siguiente quizz real
 const nextQuizURL = "https://arturohernandezm.github.io/ExamenAMG/RSM2a3.html";

 // breve pausa para que la UI muestre el resumen antes del alert
setTimeout(() => {
  const modal = document.getElementById("result-modal");
  const box = modal.querySelector(".modal-box");
  const msg = document.getElementById("modal-message");
  const btn = document.getElementById("modal-btn");

  modal.classList.remove("hidden");

  if (percent < 85) {
    box.classList.add("fail");
    msg.textContent = "Lo siento, para continuar necesitas tener 100% de aciertos.";
    btn.textContent = "Intentar de nuevo";
    btn.onclick = () => location.reload();
  } else {
    box.classList.add("success");
    msg.textContent = "¬°Felicidades! Puedes continuar.";
    btn.textContent = "Continuar";
    btn.onclick = () => window.location.href = nextQuizURL;
  }
}, 400);
}

function restartQuiz() {
 showIntro();
}

showIntro();
</script>
<div id="result-modal" class="modal hidden">
  <div class="modal-box">
    <p id="modal-message"></p>
    <button class="btn" id="modal-btn">Continuar</button>
  </div>
</div>

<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>